<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - Cuah-Quick</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="register-container">
        <div class="register-icon">ğŸ”‘</div> 
        <h2>Crear Cuenta</h2>
        
        <form id="registerForm">
            <input type="text" id="full_name" placeholder="Nombre Completo" required>
            <input type="email" id="email" placeholder="Correo ElectrÃ³nico (UCQ)" required>
            <input type="password" id="password" placeholder="ContraseÃ±a" required>
            <input type="tel" id="phone" placeholder="TelÃ©fono (10 dÃ­gitos)" required>
            <input type="text" id="student_id" placeholder="MatrÃ­cula Estudiantil" required> 
            
            <button type="submit" id="registerButton">Registrar mi Cuenta</button>
        </form>

        <p>Â¿Ya tienes cuenta? <a href="login.html">Inicia SesiÃ³n</a></p>
        <p id="message"></p>
    </div>

    <script>
        // URL de tu API en Render
        const API_BASE_URL = 'https://backend-cuah-quick-api.onrender.com/api'; 
        
        const registerForm = document.getElementById('registerForm');
        const registerButton = document.getElementById('registerButton');
        const messageDisplay = document.getElementById('message');

        registerForm.addEventListener('submit', handleRegister);

        async function handleRegister(e) {
            e.preventDefault();
            
            // Desactivar botÃ³n para evitar doble click
            registerButton.disabled = true;
            registerButton.textContent = 'Procesando...';
            messageDisplay.textContent = 'Conectando con el servidor...';
            messageDisplay.style.color = '#f39c12'; // Naranja

            const userData = {
                full_name: document.getElementById('full_name').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                phone: document.getElementById('phone').value,
                role: 'client', // Rol por defecto
                student_id: document.getElementById('student_id').value
            };

            try {
                const response = await fetch(`${API_BASE_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });
                
                const data = await response.json();

                if (response.status === 201) { 
                    messageDisplay.textContent = 'âœ… Â¡Registro exitoso! Redirigiendo...';
                    messageDisplay.style.color = '#2ecc71'; // Verde
                    
                    registerForm.reset(); 
                    setTimeout(() => {
                        window.location.href = 'login.html'; 
                    }, 2000);
                    
                } else {
                    messageDisplay.textContent = `âŒ Error: ${data.message || 'Error desconocido.'}`; 
                    messageDisplay.style.color = '#e74c3c'; // Rojo
                    registerButton.disabled = false;
                    registerButton.textContent = 'Registrar mi Cuenta';
                }
            } catch (error) {
                console.error('Error de conexiÃ³n:', error);
                messageDisplay.textContent = 'ğŸš¨ Error de red. Verifica que el servidor en Render estÃ© activo.';
                messageDisplay.style.color = '#e74c3c';
                registerButton.disabled = false;
                registerButton.textContent = 'Registrar mi Cuenta';
            }
        }
    </script>
</body>
</html>
